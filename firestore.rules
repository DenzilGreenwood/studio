
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the user is an admin
    function isAdmin() {
      // This UID should match the one in src/hooks/use-is-admin.ts
      return request.auth.uid in ['aC2Azl37NBelxACXojQOuxIRq8I2'];
    }

    // Rules for all documents within a specific user's path
    match /users/{userId}/{documents=**} {
      // A user can read and write their own documents.
      // An admin can read any user's documents.
      allow read, write: if request.auth.uid == userId;
      allow read: if isAdmin();
    }

    // Rule for the 'sessions' collection group query on the admin page.
    // This allows an admin to read from any 'sessions' collection across all users.
    match /{path=**}/sessions/{sessionId} {
      allow read: if isAdmin();
    }

    // Rules for the top-level 'feedback' collection
    match /feedback/{feedbackId} {
      // Any authenticated user can create (submit) feedback.
      allow create: if request.auth != null;
      // Only admins can read all feedback documents.
      allow read: if isAdmin();
    }
  }
}
